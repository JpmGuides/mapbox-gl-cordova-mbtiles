/* Mapbox GL JS is licensed under the 3-Clause BSD License. Full text of license: https://github.com/mapbox/mapbox-gl-js/blob/v0.3.1/LICENSE.txt */
(function (global, factory) {
typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
typeof define === 'function' && define.amd ? define(factory) :
(global.mapboxgl = factory());
}(this, (function () { 'use strict';

/* eslint-disable */

var shared, worker, mapboxgl;
// define gets called three times: one for each chunk. we rely on the order
// they're imported to know which is which
function define(_, chunk) {
if (!shared) {
    shared = chunk;
} else if (!worker) {
    worker = chunk;
} else {
    var workerBundleString = 'var sharedChunk = {}; (' + shared + ')(sharedChunk); (' + worker + ')(sharedChunk);'

    var sharedChunk = {};
    shared(sharedChunk);
    mapboxgl = chunk(sharedChunk);
    mapboxgl.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], { type: 'text/javascript' }));
}
}

define(["exports","mapbox-gl/src/source/raster_tile_source","mapbox-gl/src/util/util","mapbox-gl/src/render/texture","mapbox-gl/src/source/raster_dem_tile_source","mapbox-gl/src/util/browser"],function(e,t,i,o,a,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o,a=a&&a.hasOwnProperty("default")?a.default:a,n=n&&n.hasOwnProperty("default")?n.default:n;var r=function(){};r.getDatabaseDir=function(){return "sqlitePlugin"in self?"device"in self?new Promise(function(e,t){"Android"===device.platform?resolveLocalFileSystemURL(cordova.file.applicationStorageDirectory,function(t){t.getDirectory("databases",{create:!0},function(t){e(t);});},t):"iOS"===device.platform?resolveLocalFileSystemURL(cordova.file.documentsDirectory,e,t):t("Platform not supported");}):Promise.reject(new Error("cordova-plugin-device not available. Please install the plugin and make sure this code is run after onDeviceReady event")):Promise.reject(new Error("cordova-sqlite-ext plugin not available. Please install the plugin and make sure this code is run after onDeviceReady event"))},r.openDatabase=function(e){var t=e.split("/").slice(-1)[0],i=this;return this.getDatabaseDir().then(function(o){return new Promise(function(e,i){o.getFile(t,{},e,i);}).catch(function(){return i.copyDatabaseFile(e,t,o)})}).then(function(){var e={name:t};return "iOS"===device.platform?e.iosDatabaseLocation="Documents":e.location="default",sqlitePlugin.openDatabase(e)})},r.copyDatabaseFile=function(e,t,i){return console.log("Copying database to application storage directory"),new Promise(function(t,i){var o=cordova.file.applicationDirectory+"www/"+e;resolveLocalFileSystemURL(o,t,i);}).then(function(e){return new Promise(function(o,a){e.copyTo(i,t,o,a);}).then(function(){console.log("Database copied");})})};var l=function(e){function t(t,o,a,n){e.call(this,t,o,a,n),this.id=t,this.dispatcher=a,this.setEventedParent(n),this.type="rasteroffline",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this.imageFormat="png",this._loaded=!1,this._options=i.extend({},o),i.extend(this,i.pick(o,["scheme","tileSize","imageFormat"])),this._transparentPngUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.db=this.openDatabase(o.path);}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.openDatabase=function(e){return r.openDatabase(e)},t.prototype.copyDatabaseFile=function(e,t,i){return r.copyDatabaseFile(e,t,i)},t.prototype.loadTile=function(t,i){t.request=this._getImage(t.tileID.canonical,function(a,n){if(delete t.request,t.aborted&&window.allowMapboxOfflineMapOnlineTile)t.state="unloaded",i(null);else if(a)this.url?e.prototype.loadTile.call(this,t,i):(t.state="errored",i(a));else if(n){this.map._refreshExpiredTiles&&t.setExpiryData(n),delete n.cacheControl,delete n.expires;var r=this.map.painter.context,l=r.gl;t.texture=this.map.painter.getTileTexture(n.width),t.texture?t.texture.update(n,{useMipmap:!0}):(t.texture=new o(r,n,l.RGBA,{useMipmap:!0}),t.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),r.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax)),t.state="loaded",i(null);}}.bind(this));},t.prototype._getBlob=function(e,t){var i=this,o=Math.pow(2,e.z)-1-e.y,a=[e.z,e.x,o],n="data:image/"+this.imageFormat+";base64,";this.db.then(function(e){e.transaction(function(e){e.executeSql("SELECT BASE64(tile_data) AS base64_tile_data FROM tiles WHERE zoom_level = ? AND tile_column = ? AND tile_row = ?",a,function(e,o){o.rows.length?t(void 0,{data:n+o.rows.item(0).base64_tile_data,cacheControl:null,expires:null}):i.url?t(new Error("tile "+a.join(",")+" not found")):(console.error("tile "+a.join(",")+" not found"),t(void 0,{data:i._transparentPngUrl,cacheControl:null,expires:null}));});},function(e){t(e);});}).catch(function(e){t(e);});},t.prototype._getImage=function(e,t){return this._getBlob(e,function(e,i){if(e)return t(e);var o=new window.Image,a=window.URL||window.webkitURL;o.onload=function(){t(null,o),a.revokeObjectURL(o.src);},o.cacheControl=i.cacheControl,o.expires=i.expires,o.src=i.data;})},t}(t),s=function(e){function t(t,o,a,n){e.call(this,t,o,a,n),this.id=t,this.dispatcher=a,this.setEventedParent(n),this.type="raster-dem-offline",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this.imageFormat="png",this._loaded=!1,this._options=i.extend({},o),i.extend(this,i.pick(o,["scheme","tileSize","imageFormat"])),this._transparentPngUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",this.db=this.openDatabase(o.path);}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.openDatabase=function(e){return r.openDatabase(e)},t.prototype.copyDatabaseFile=function(e,t,i){return r.copyDatabaseFile(e,t,i)},t.prototype.loadTile=function(t,i){t.request=this._getImage(t.tileID.canonical,function(o,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(o)this.url&&window.allowMapboxOfflineMapOnlineTile?e.prototype.loadTile.call(this,t,i):(t.state="errored",i(o));else if(a){this.map._refreshExpiredTiles&&t.setExpiryData(a),delete a.cacheControl,delete a.expires;var r=n.getImageData(a),l={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:r,encoding:this.encoding};t.workerID&&"expired"!==t.state||(t.workerID=this.dispatcher.send("loadDEMTile",l,function(e,o){e&&(t.state="errored",i(e));o&&(t.dem=o,t.needsHillshadePrepare=!0,t.state="loaded",i(null));}.bind(this)));}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID);},t.prototype._getBlob=function(e,t){var i=this,o=Math.pow(2,e.z)-1-e.y,a=[e.z,e.x,o],n="data:image/"+this.imageFormat+";base64,";this.db.then(function(e){e.transaction(function(e){e.executeSql("SELECT BASE64(tile_data) AS base64_tile_data FROM tiles WHERE zoom_level = ? AND tile_column = ? AND tile_row = ?",a,function(e,o){o.rows.length?t(void 0,{data:n+o.rows.item(0).base64_tile_data,cacheControl:null,expires:null}):i.url?t(new Error("tile "+a.join(",")+" not found")):(console.error("tile "+a.join(",")+" not found"),t(void 0,{data:i._transparentPngUrl,cacheControl:null,expires:null}));});},function(e){t(e);});}).catch(function(e){t(e);});},t.prototype._getImage=function(e,t){return this._getBlob(e,function(e,i){if(e)return t(e);var o=new window.Image,a=window.URL||window.webkitURL;o.onload=function(){t(null,o),a.revokeObjectURL(o.src);},o.cacheControl=i.cacheControl,o.expires=i.expires,o.src=i.data;})},t}(a);e.Database=r,e.RasterTileSourceOffline=l,e.RasterDEMTileSourceOffline=s;});

define(["mapbox-gl/src/util/actor","mapbox-gl/src/style/style_layer_index","mapbox-gl/src/source/vector_tile_worker_source","mapbox-gl/src/source/raster_dem_tile_worker_source","./shared.js","mapbox-gl/src/source/geojson_worker_source","mapbox-gl/src/source/rtl_text_plugin","mapbox-gl/src/source/raster_tile_source","mapbox-gl/src/util/util","mapbox-gl/src/render/texture","mapbox-gl/src/source/raster_dem_tile_source","mapbox-gl/src/util/browser"],function(e,r,o,t,s,i,u,c,l,n,a,p){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,r=r&&r.hasOwnProperty("default")?r.default:r,o=o&&o.hasOwnProperty("default")?o.default:o,t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i,c=c&&c.hasOwnProperty("default")?c.default:c,n=n&&n.hasOwnProperty("default")?n.default:n,a=a&&a.hasOwnProperty("default")?a.default:a,p=p&&p.hasOwnProperty("default")?p.default:p;var d=function(r){var t=this;this.self=r,this.actor=new e(r,this),this.layerIndexes={},this.workerSourceTypes={vector:o,mbtiles:o,geojson:i,rasteroffline:s.RasterTileSourceOffline,"raster-dem-offline":s.RasterDEMTileSourceOffline},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,r){if(t.workerSourceTypes[e])throw new Error('Worker source with name "'+e+'" already registered.');t.workerSourceTypes[e]=r;},this.self.registerRTLTextPlugin=function(e){if(u.plugin.isLoaded())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=e.applyArabicShaping,u.plugin.processBidirectionalText=e.processBidirectionalText,u.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText;};};return d.prototype.setReferrer=function(e,r){this.referrer=r;},d.prototype.setLayers=function(e,r,o){this.getLayerIndex(e).replace(r),o();},d.prototype.updateLayers=function(e,r,o){this.getLayerIndex(e).update(r.layers,r.removedIds),o();},d.prototype.loadTile=function(e,r,o){this.getWorkerSource(e,r.type,r.source).loadTile(r,o);},d.prototype.loadDEMTile=function(e,r,o){this.getDEMWorkerSource(e,r.source).loadTile(r,o);},d.prototype.reloadTile=function(e,r,o){this.getWorkerSource(e,r.type,r.source).reloadTile(r,o);},d.prototype.abortTile=function(e,r,o){this.getWorkerSource(e,r.type,r.source).abortTile(r,o);},d.prototype.removeTile=function(e,r,o){this.getWorkerSource(e,r.type,r.source).removeTile(r,o);},d.prototype.removeDEMTile=function(e,r){this.getDEMWorkerSource(e,r.source).removeTile(r);},d.prototype.removeSource=function(e,r,o){if(this.workerSources[e]&&this.workerSources[e][r.type]&&this.workerSources[e][r.type][r.source]){var t=this.workerSources[e][r.type][r.source];delete this.workerSources[e][r.type][r.source],void 0!==t.removeSource?t.removeSource(r,o):o();}},d.prototype.loadWorkerSource=function(e,r,o){try{this.self.importScripts(r.url),o();}catch(e){o(e.toString());}},d.prototype.loadRTLTextPlugin=function(e,r,o){try{u.plugin.isLoaded()||(this.self.importScripts(r),o(u.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+r)));}catch(e){o(e.toString());}},d.prototype.getLayerIndex=function(e){var o=this.layerIndexes[e];return o||(o=this.layerIndexes[e]=new r),o},d.prototype.getWorkerSource=function(e,r,o){var t=this;if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][r]||(this.workerSources[e][r]={}),!this.workerSources[e][r][o]){var s={send:function(r,o,s){t.actor.send(r,o,s,e);}};this.workerSources[e][r][o]=new this.workerSourceTypes[r](s,this.getLayerIndex(e));}return this.workerSources[e][r][o]},d.prototype.getDEMWorkerSource=function(e,r){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][r]||(this.demWorkerSources[e][r]=new t),this.demWorkerSources[e][r]},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new d(self)),d});

define(["mapbox-gl/src/source/vector_tile_source","./shared.js","mapbox-gl/src/ui/map","mapbox-gl/src/util/util","mapbox-gl/src/index","mapbox-gl/src/source/raster_tile_source","mapbox-gl/src/render/texture","mapbox-gl/src/source/raster_dem_tile_source","mapbox-gl/src/util/browser"],function(e,t,a,n,i,r,o,s,l){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,a=a&&a.hasOwnProperty("default")?a.default:a,i=i&&i.hasOwnProperty("default")?i.default:i,r=r&&r.hasOwnProperty("default")?r.default:r,o=o&&o.hasOwnProperty("default")?o.default:o,s=s&&s.hasOwnProperty("default")?s.default:s,l=l&&l.hasOwnProperty("default")?l.default:l;var f,d=(function(e,t){var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(var i in a)n(a,i)&&(e[i]=a[i]);}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,a,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(a,a+n),i);else for(var r=0;r<n;r++)e[i+r]=t[a+r];},flattenChunks:function(e){var t,a,n,i,r,o;for(n=0,t=0,a=e.length;t<a;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,a=e.length;t<a;t++)r=e[t],o.set(r,i),i+=r.length;return o}},r={arraySet:function(e,t,a,n,i){for(var r=0;r<n;r++)e[i+r]=t[a+r];},flattenChunks:function(e){return [].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r));},t.setTyped(a);}(f={exports:{}},f.exports),f.exports);d.assign,d.shrinkBuf,d.setTyped,d.Buf8,d.Buf16,d.Buf32;var u=function(e,t,a,n){for(var i=65535&e|0,r=e>>>16&65535|0,o=0;0!==a;){a-=o=a>2e3?2e3:a;do{r=r+(i=i+t[n++]|0)|0;}while(--o);i%=65521,r%=65521;}return i|r<<16|0};var c=function(){for(var e,t=[],a=0;a<256;a++){e=a;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e;}return t}();var h=function(e,t,a,n){var i=c,r=n+a;e^=-1;for(var o=n;o<r;o++)e=e>>>8^i[255&(e^t[o])];return -1^e},w=function(e,t){var a,n,i,r,o,s,l,f,d,u,c,h,w,m,p,b,g,k,y,_,v,x,S,A,E;a=e.state,n=e.next_in,A=e.input,i=n+(e.avail_in-5),r=e.next_out,E=e.output,o=r-(t-e.avail_out),s=r+(e.avail_out-257),l=a.dmax,f=a.wsize,d=a.whave,u=a.wnext,c=a.window,h=a.hold,w=a.bits,m=a.lencode,p=a.distcode,b=(1<<a.lenbits)-1,g=(1<<a.distbits)-1;e:do{w<15&&(h+=A[n++]<<w,w+=8,h+=A[n++]<<w,w+=8),k=m[h&b];t:for(;;){if(h>>>=y=k>>>24,w-=y,0===(y=k>>>16&255))E[r++]=65535&k;else{if(!(16&y)){if(0==(64&y)){k=m[(65535&k)+(h&(1<<y)-1)];continue t}if(32&y){a.mode=12;break e}e.msg="invalid literal/length code",a.mode=30;break e}_=65535&k,(y&=15)&&(w<y&&(h+=A[n++]<<w,w+=8),_+=h&(1<<y)-1,h>>>=y,w-=y),w<15&&(h+=A[n++]<<w,w+=8,h+=A[n++]<<w,w+=8),k=p[h&g];a:for(;;){if(h>>>=y=k>>>24,w-=y,!(16&(y=k>>>16&255))){if(0==(64&y)){k=p[(65535&k)+(h&(1<<y)-1)];continue a}e.msg="invalid distance code",a.mode=30;break e}if(v=65535&k,w<(y&=15)&&(h+=A[n++]<<w,(w+=8)<y&&(h+=A[n++]<<w,w+=8)),(v+=h&(1<<y)-1)>l){e.msg="invalid distance too far back",a.mode=30;break e}if(h>>>=y,w-=y,v>(y=r-o)){if((y=v-y)>d&&a.sane){e.msg="invalid distance too far back",a.mode=30;break e}if(x=0,S=c,0===u){if(x+=f-y,y<_){_-=y;do{E[r++]=c[x++];}while(--y);x=r-v,S=E;}}else if(u<y){if(x+=f+u-y,(y-=u)<_){_-=y;do{E[r++]=c[x++];}while(--y);if(x=0,u<_){_-=y=u;do{E[r++]=c[x++];}while(--y);x=r-v,S=E;}}}else if(x+=u-y,y<_){_-=y;do{E[r++]=c[x++];}while(--y);x=r-v,S=E;}for(;_>2;)E[r++]=S[x++],E[r++]=S[x++],E[r++]=S[x++],_-=3;_&&(E[r++]=S[x++],_>1&&(E[r++]=S[x++]));}else{x=r-v;do{E[r++]=E[x++],E[r++]=E[x++],E[r++]=E[x++],_-=3;}while(_>2);_&&(E[r++]=E[x++],_>1&&(E[r++]=E[x++]));}break}}break}}while(n<i&&r<s);n-=_=w>>3,h&=(1<<(w-=_<<3))-1,e.next_in=n,e.next_out=r,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=r<s?s-r+257:257-(r-s),a.hold=h,a.bits=w;},m=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],b=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],k=function(e,t,a,n,i,r,o,s){var l,f,u,c,h,w,k,y,_,v=s.bits,x=0,S=0,A=0,E=0,B=0,O=0,C=0,Z=0,D=0,R=0,T=null,N=0,I=new d.Buf16(16),z=new d.Buf16(16),U=null,L=0;for(x=0;x<=15;x++)I[x]=0;for(S=0;S<n;S++)I[t[a+S]]++;for(B=v,E=15;E>=1&&0===I[E];E--);if(B>E&&(B=E),0===E)return i[r++]=20971520,i[r++]=20971520,s.bits=1,0;for(A=1;A<E&&0===I[A];A++);for(B<A&&(B=A),Z=1,x=1;x<=15;x++)if(Z<<=1,(Z-=I[x])<0)return -1;if(Z>0&&(0===e||1!==E))return -1;for(z[1]=0,x=1;x<15;x++)z[x+1]=z[x]+I[x];for(S=0;S<n;S++)0!==t[a+S]&&(o[z[t[a+S]]++]=S);if(0===e?(T=U=o,w=19):1===e?(T=m,N-=257,U=p,L-=257,w=256):(T=b,U=g,w=-1),R=0,S=0,x=A,h=r,O=B,C=0,u=-1,c=(D=1<<B)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){k=x-C,o[S]<w?(y=0,_=o[S]):o[S]>w?(y=U[L+o[S]],_=T[N+o[S]]):(y=96,_=0),l=1<<x-C,A=f=1<<O;do{i[h+(R>>C)+(f-=l)]=k<<24|y<<16|_|0;}while(0!==f);for(l=1<<x-1;R&l;)l>>=1;if(0!==l?(R&=l-1,R+=l):R=0,S++,0==--I[x]){if(x===E)break;x=t[a+o[S]];}if(x>B&&(R&c)!==u){for(0===C&&(C=B),h+=A,Z=1<<(O=x-C);O+C<E&&!((Z-=I[O+C])<=0);)O++,Z<<=1;if(D+=1<<O,1===e&&D>852||2===e&&D>592)return 1;i[u=R&c]=B<<24|O<<16|h-r|0;}}return 0!==R&&(i[h+R]=x-C<<24|64<<16|0),s.bits=B,0},y=0,_=1,v=2,x=4,S=5,A=6,E=0,B=1,O=2,C=-2,Z=-3,D=-4,R=-5,T=8,N=1,I=2,z=3,U=4,L=5,F=6,P=7,j=8,H=9,M=10,K=11,Y=12,J=13,q=14,G=15,X=16,W=17,V=18,Q=19,$=20,ee=21,te=22,ae=23,ne=24,ie=25,re=26,oe=27,se=28,le=29,fe=30,de=31,ue=32,ce=852,he=592,we=15;function me(e){return (e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function pe(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0;}function be(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=N,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new d.Buf32(ce),t.distcode=t.distdyn=new d.Buf32(he),t.sane=1,t.back=-1,E):C}function ge(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,be(e)):C}function ke(e,t){var a,n;return e&&e.state?(n=e.state,t<0?(a=0,t=-t):(a=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?C:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=a,n.wbits=t,ge(e))):C}function ye(e,t){var a,n;return e?(n=new pe,e.state=n,n.window=null,(a=ke(e,t))!==E&&(e.state=null),a):C}var _e,ve,xe=!0;function Se(e){if(xe){var t;for(_e=new d.Buf32(512),ve=new d.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(k(_,e.lens,0,288,_e,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;k(v,e.lens,0,32,ve,0,e.work,{bits:5}),xe=!1;}e.lencode=_e,e.lenbits=9,e.distcode=ve,e.distbits=5;}function Ae(e,t,a,n){var i,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new d.Buf8(r.wsize)),n>=r.wsize?(d.arraySet(r.window,t,a-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((i=r.wsize-r.wnext)>n&&(i=n),d.arraySet(r.window,t,a-n,i,r.wnext),(n-=i)?(d.arraySet(r.window,t,a-n,n,0),r.wnext=n,r.whave=r.wsize):(r.wnext+=i,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=i))),0}var Ee={inflateReset:ge,inflateReset2:ke,inflateResetKeep:be,inflateInit:function(e){return ye(e,we)},inflateInit2:ye,inflate:function(e,t){var a,n,i,r,o,s,l,f,c,m,p,b,g,ce,he,we,pe,be,ge,ke,ye,_e,ve,xe,Ee=0,Be=new d.Buf8(4),Oe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return C;(a=e.state).mode===Y&&(a.mode=J),o=e.next_out,i=e.output,l=e.avail_out,r=e.next_in,n=e.input,s=e.avail_in,f=a.hold,c=a.bits,m=s,p=l,_e=E;e:for(;;)switch(a.mode){case N:if(0===a.wrap){a.mode=J;break}for(;c<16;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(2&a.wrap&&35615===f){a.check=0,Be[0]=255&f,Be[1]=f>>>8&255,a.check=h(a.check,Be,2,0),f=0,c=0,a.mode=I;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",a.mode=fe;break}if((15&f)!==T){e.msg="unknown compression method",a.mode=fe;break}if(c-=4,ye=8+(15&(f>>>=4)),0===a.wbits)a.wbits=ye;else if(ye>a.wbits){e.msg="invalid window size",a.mode=fe;break}a.dmax=1<<ye,e.adler=a.check=1,a.mode=512&f?M:Y,f=0,c=0;break;case I:for(;c<16;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(a.flags=f,(255&a.flags)!==T){e.msg="unknown compression method",a.mode=fe;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=fe;break}a.head&&(a.head.text=f>>8&1),512&a.flags&&(Be[0]=255&f,Be[1]=f>>>8&255,a.check=h(a.check,Be,2,0)),f=0,c=0,a.mode=z;case z:for(;c<32;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}a.head&&(a.head.time=f),512&a.flags&&(Be[0]=255&f,Be[1]=f>>>8&255,Be[2]=f>>>16&255,Be[3]=f>>>24&255,a.check=h(a.check,Be,4,0)),f=0,c=0,a.mode=U;case U:for(;c<16;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}a.head&&(a.head.xflags=255&f,a.head.os=f>>8),512&a.flags&&(Be[0]=255&f,Be[1]=f>>>8&255,a.check=h(a.check,Be,2,0)),f=0,c=0,a.mode=L;case L:if(1024&a.flags){for(;c<16;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}a.length=f,a.head&&(a.head.extra_len=f),512&a.flags&&(Be[0]=255&f,Be[1]=f>>>8&255,a.check=h(a.check,Be,2,0)),f=0,c=0;}else a.head&&(a.head.extra=null);a.mode=F;case F:if(1024&a.flags&&((b=a.length)>s&&(b=s),b&&(a.head&&(ye=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Array(a.head.extra_len)),d.arraySet(a.head.extra,n,r,b,ye)),512&a.flags&&(a.check=h(a.check,n,b,r)),s-=b,r+=b,a.length-=b),a.length))break e;a.length=0,a.mode=P;case P:if(2048&a.flags){if(0===s)break e;b=0;do{ye=n[r+b++],a.head&&ye&&a.length<65536&&(a.head.name+=String.fromCharCode(ye));}while(ye&&b<s);if(512&a.flags&&(a.check=h(a.check,n,b,r)),s-=b,r+=b,ye)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=j;case j:if(4096&a.flags){if(0===s)break e;b=0;do{ye=n[r+b++],a.head&&ye&&a.length<65536&&(a.head.comment+=String.fromCharCode(ye));}while(ye&&b<s);if(512&a.flags&&(a.check=h(a.check,n,b,r)),s-=b,r+=b,ye)break e}else a.head&&(a.head.comment=null);a.mode=H;case H:if(512&a.flags){for(;c<16;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(f!==(65535&a.check)){e.msg="header crc mismatch",a.mode=fe;break}f=0,c=0;}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=Y;break;case M:for(;c<32;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}e.adler=a.check=me(f),f=0,c=0,a.mode=K;case K:if(0===a.havedict)return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=s,a.hold=f,a.bits=c,O;e.adler=a.check=1,a.mode=Y;case Y:if(t===S||t===A)break e;case J:if(a.last){f>>>=7&c,c-=7&c,a.mode=oe;break}for(;c<3;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}switch(a.last=1&f,c-=1,3&(f>>>=1)){case 0:a.mode=q;break;case 1:if(Se(a),a.mode=$,t===A){f>>>=2,c-=2;break e}break;case 2:a.mode=W;break;case 3:e.msg="invalid block type",a.mode=fe;}f>>>=2,c-=2;break;case q:for(f>>>=7&c,c-=7&c;c<32;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",a.mode=fe;break}if(a.length=65535&f,f=0,c=0,a.mode=G,t===A)break e;case G:a.mode=X;case X:if(b=a.length){if(b>s&&(b=s),b>l&&(b=l),0===b)break e;d.arraySet(i,n,r,b,o),s-=b,r+=b,l-=b,o+=b,a.length-=b;break}a.mode=Y;break;case W:for(;c<14;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(a.nlen=257+(31&f),f>>>=5,c-=5,a.ndist=1+(31&f),f>>>=5,c-=5,a.ncode=4+(15&f),f>>>=4,c-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=fe;break}a.have=0,a.mode=V;case V:for(;a.have<a.ncode;){for(;c<3;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}a.lens[Oe[a.have++]]=7&f,f>>>=3,c-=3;}for(;a.have<19;)a.lens[Oe[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,ve={bits:a.lenbits},_e=k(y,a.lens,0,19,a.lencode,0,a.work,ve),a.lenbits=ve.bits,_e){e.msg="invalid code lengths set",a.mode=fe;break}a.have=0,a.mode=Q;case Q:for(;a.have<a.nlen+a.ndist;){for(;we=(Ee=a.lencode[f&(1<<a.lenbits)-1])>>>16&255,pe=65535&Ee,!((he=Ee>>>24)<=c);){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(pe<16)f>>>=he,c-=he,a.lens[a.have++]=pe;else{if(16===pe){for(xe=he+2;c<xe;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(f>>>=he,c-=he,0===a.have){e.msg="invalid bit length repeat",a.mode=fe;break}ye=a.lens[a.have-1],b=3+(3&f),f>>>=2,c-=2;}else if(17===pe){for(xe=he+3;c<xe;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}c-=he,ye=0,b=3+(7&(f>>>=he)),f>>>=3,c-=3;}else{for(xe=he+7;c<xe;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}c-=he,ye=0,b=11+(127&(f>>>=he)),f>>>=7,c-=7;}if(a.have+b>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=fe;break}for(;b--;)a.lens[a.have++]=ye;}}if(a.mode===fe)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=fe;break}if(a.lenbits=9,ve={bits:a.lenbits},_e=k(_,a.lens,0,a.nlen,a.lencode,0,a.work,ve),a.lenbits=ve.bits,_e){e.msg="invalid literal/lengths set",a.mode=fe;break}if(a.distbits=6,a.distcode=a.distdyn,ve={bits:a.distbits},_e=k(v,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,ve),a.distbits=ve.bits,_e){e.msg="invalid distances set",a.mode=fe;break}if(a.mode=$,t===A)break e;case $:a.mode=ee;case ee:if(s>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=s,a.hold=f,a.bits=c,w(e,p),o=e.next_out,i=e.output,l=e.avail_out,r=e.next_in,n=e.input,s=e.avail_in,f=a.hold,c=a.bits,a.mode===Y&&(a.back=-1);break}for(a.back=0;we=(Ee=a.lencode[f&(1<<a.lenbits)-1])>>>16&255,pe=65535&Ee,!((he=Ee>>>24)<=c);){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(we&&0==(240&we)){for(be=he,ge=we,ke=pe;we=(Ee=a.lencode[ke+((f&(1<<be+ge)-1)>>be)])>>>16&255,pe=65535&Ee,!(be+(he=Ee>>>24)<=c);){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}f>>>=be,c-=be,a.back+=be;}if(f>>>=he,c-=he,a.back+=he,a.length=pe,0===we){a.mode=re;break}if(32&we){a.back=-1,a.mode=Y;break}if(64&we){e.msg="invalid literal/length code",a.mode=fe;break}a.extra=15&we,a.mode=te;case te:if(a.extra){for(xe=a.extra;c<xe;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}a.length+=f&(1<<a.extra)-1,f>>>=a.extra,c-=a.extra,a.back+=a.extra;}a.was=a.length,a.mode=ae;case ae:for(;we=(Ee=a.distcode[f&(1<<a.distbits)-1])>>>16&255,pe=65535&Ee,!((he=Ee>>>24)<=c);){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(0==(240&we)){for(be=he,ge=we,ke=pe;we=(Ee=a.distcode[ke+((f&(1<<be+ge)-1)>>be)])>>>16&255,pe=65535&Ee,!(be+(he=Ee>>>24)<=c);){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}f>>>=be,c-=be,a.back+=be;}if(f>>>=he,c-=he,a.back+=he,64&we){e.msg="invalid distance code",a.mode=fe;break}a.offset=pe,a.extra=15&we,a.mode=ne;case ne:if(a.extra){for(xe=a.extra;c<xe;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}a.offset+=f&(1<<a.extra)-1,f>>>=a.extra,c-=a.extra,a.back+=a.extra;}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=fe;break}a.mode=ie;case ie:if(0===l)break e;if(b=p-l,a.offset>b){if((b=a.offset-b)>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=fe;break}b>a.wnext?(b-=a.wnext,g=a.wsize-b):g=a.wnext-b,b>a.length&&(b=a.length),ce=a.window;}else ce=i,g=o-a.offset,b=a.length;b>l&&(b=l),l-=b,a.length-=b;do{i[o++]=ce[g++];}while(--b);0===a.length&&(a.mode=ee);break;case re:if(0===l)break e;i[o++]=a.length,l--,a.mode=ee;break;case oe:if(a.wrap){for(;c<32;){if(0===s)break e;s--,f|=n[r++]<<c,c+=8;}if(p-=l,e.total_out+=p,a.total+=p,p&&(e.adler=a.check=a.flags?h(a.check,i,p,o-p):u(a.check,i,p,o-p)),p=l,(a.flags?f:me(f))!==a.check){e.msg="incorrect data check",a.mode=fe;break}f=0,c=0;}a.mode=se;case se:if(a.wrap&&a.flags){for(;c<32;){if(0===s)break e;s--,f+=n[r++]<<c,c+=8;}if(f!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=fe;break}f=0,c=0;}a.mode=le;case le:_e=B;break e;case fe:_e=Z;break e;case de:return D;case ue:default:return C}return e.next_out=o,e.avail_out=l,e.next_in=r,e.avail_in=s,a.hold=f,a.bits=c,(a.wsize||p!==e.avail_out&&a.mode<fe&&(a.mode<oe||t!==x))&&Ae(e,e.output,e.next_out,p-e.avail_out),m-=e.avail_in,p-=e.avail_out,e.total_in+=m,e.total_out+=p,a.total+=p,a.wrap&&p&&(e.adler=a.check=a.flags?h(a.check,i,p,e.next_out-p):u(a.check,i,p,e.next_out-p)),e.data_type=a.bits+(a.last?64:0)+(a.mode===Y?128:0)+(a.mode===$||a.mode===G?256:0),(0===m&&0===p||t===x)&&_e===E&&(_e=R),_e},inflateEnd:function(e){if(!e||!e.state)return C;var t=e.state;return t.window&&(t.window=null),e.state=null,E},inflateGetHeader:function(e,t){var a;return e&&e.state?0==(2&(a=e.state).wrap)?C:(a.head=t,t.done=!1,E):C},inflateSetDictionary:function(e,t){var a,n=t.length;return e&&e.state?0!==(a=e.state).wrap&&a.mode!==K?C:a.mode===K&&u(1,t,n,0)!==a.check?Z:Ae(e,t,n,n)?(a.mode=de,D):(a.havedict=1,E):C},inflateInfo:"pako inflate (from Nodeca project)"},Be=!0,Oe=!0;try{String.fromCharCode.apply(null,[0]);}catch(e){Be=!1;}try{String.fromCharCode.apply(null,new Uint8Array(1));}catch(e){Oe=!1;}for(var Ce=new d.Buf8(256),Ze=0;Ze<256;Ze++)Ce[Ze]=Ze>=252?6:Ze>=248?5:Ze>=240?4:Ze>=224?3:Ze>=192?2:1;Ce[254]=Ce[254]=1;function De(e,t){if(t<65537&&(e.subarray&&Oe||!e.subarray&&Be))return String.fromCharCode.apply(null,d.shrinkBuf(e,t));for(var a="",n=0;n<t;n++)a+=String.fromCharCode(e[n]);return a}var Re=function(e){var t,a,n,i,r,o=e.length,s=0;for(i=0;i<o;i++)55296==(64512&(a=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(n=e.charCodeAt(i+1)))&&(a=65536+(a-55296<<10)+(n-56320),i++),s+=a<128?1:a<2048?2:a<65536?3:4;for(t=new d.Buf8(s),r=0,i=0;r<s;i++)55296==(64512&(a=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(n=e.charCodeAt(i+1)))&&(a=65536+(a-55296<<10)+(n-56320),i++),a<128?t[r++]=a:a<2048?(t[r++]=192|a>>>6,t[r++]=128|63&a):a<65536?(t[r++]=224|a>>>12,t[r++]=128|a>>>6&63,t[r++]=128|63&a):(t[r++]=240|a>>>18,t[r++]=128|a>>>12&63,t[r++]=128|a>>>6&63,t[r++]=128|63&a);return t},Te=function(e){for(var t=new d.Buf8(e.length),a=0,n=t.length;a<n;a++)t[a]=e.charCodeAt(a);return t},Ne=function(e,t){var a,n,i,r,o=t||e.length,s=new Array(2*o);for(n=0,a=0;a<o;)if((i=e[a++])<128)s[n++]=i;else if((r=Ce[i])>4)s[n++]=65533,a+=r-1;else{for(i&=2===r?31:3===r?15:7;r>1&&a<o;)i=i<<6|63&e[a++],r--;r>1?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023&i);}return De(s,n)},Ie=function(e,t){var a;for((t=t||e.length)>e.length&&(t=e.length),a=t-1;a>=0&&128==(192&e[a]);)a--;return a<0?t:0===a?t:a+Ce[e[a]]>t?a:t},ze={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Ue={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var Le=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0;};var Fe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1;},Pe=Object.prototype.toString;function je(e){if(!(this instanceof je))return new je(e);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Le,this.strm.avail_out=0;var a=Ee.inflateInit2(this.strm,t.windowBits);if(a!==ze.Z_OK)throw new Error(Ue[a]);this.header=new Fe,Ee.inflateGetHeader(this.strm,this.header);}function He(e,t){var a=new je(t);if(a.push(e,!0),a.err)throw a.msg||Ue[a.err];return a.result}je.prototype.push=function(e,t){var a,n,i,r,o,s,l=this.strm,f=this.options.chunkSize,u=this.options.dictionary,c=!1;if(this.ended)return !1;n=t===~~t?t:!0===t?ze.Z_FINISH:ze.Z_NO_FLUSH,"string"==typeof e?l.input=Te(e):"[object ArrayBuffer]"===Pe.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new d.Buf8(f),l.next_out=0,l.avail_out=f),(a=Ee.inflate(l,ze.Z_NO_FLUSH))===ze.Z_NEED_DICT&&u&&(s="string"==typeof u?Re(u):"[object ArrayBuffer]"===Pe.call(u)?new Uint8Array(u):u,a=Ee.inflateSetDictionary(this.strm,s)),a===ze.Z_BUF_ERROR&&!0===c&&(a=ze.Z_OK,c=!1),a!==ze.Z_STREAM_END&&a!==ze.Z_OK)return this.onEnd(a),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&a!==ze.Z_STREAM_END&&(0!==l.avail_in||n!==ze.Z_FINISH&&n!==ze.Z_SYNC_FLUSH)||("string"===this.options.to?(i=Ie(l.output,l.next_out),r=l.next_out-i,o=Ne(l.output,i),l.next_out=r,l.avail_out=f-r,r&&d.arraySet(l.output,l.output,i,r,0),this.onData(o)):this.onData(d.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(c=!0);}while((l.avail_in>0||0===l.avail_out)&&a!==ze.Z_STREAM_END);return a===ze.Z_STREAM_END&&(n=ze.Z_FINISH),n===ze.Z_FINISH?(a=Ee.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===ze.Z_OK):n!==ze.Z_SYNC_FLUSH||(this.onEnd(ze.Z_OK),l.avail_out=0,!0)},je.prototype.onData=function(e){this.chunks.push(e);},je.prototype.onEnd=function(e){e===ze.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg;};for(var Me={Inflate:je,inflate:He,inflateRaw:function(e,t){return (t=t||{}).raw=!0,He(e,t)},ungzip:He},Ke=function(e){var t=$e(e),a=t[0],n=t[1];return 3*(a+n)/4-n},Ye=function(e){for(var t,a=$e(e),n=a[0],i=a[1],r=new Xe(function(e,t,a){return 3*(t+a)/4-a}(0,n,i)),o=0,s=i>0?n-4:n,l=0;l<s;l+=4)t=Ge[e.charCodeAt(l)]<<18|Ge[e.charCodeAt(l+1)]<<12|Ge[e.charCodeAt(l+2)]<<6|Ge[e.charCodeAt(l+3)],r[o++]=t>>16&255,r[o++]=t>>8&255,r[o++]=255&t;2===i&&(t=Ge[e.charCodeAt(l)]<<2|Ge[e.charCodeAt(l+1)]>>4,r[o++]=255&t);1===i&&(t=Ge[e.charCodeAt(l)]<<10|Ge[e.charCodeAt(l+1)]<<4|Ge[e.charCodeAt(l+2)]>>2,r[o++]=t>>8&255,r[o++]=255&t);return r},Je=function(e){for(var t,a=e.length,n=a%3,i=[],r=0,o=a-n;r<o;r+=16383)i.push(et(e,r,r+16383>o?o:r+16383));1===n?(t=e[a-1],i.push(qe[t>>2]+qe[t<<4&63]+"==")):2===n&&(t=(e[a-2]<<8)+e[a-1],i.push(qe[t>>10]+qe[t>>4&63]+qe[t<<2&63]+"="));return i.join("")},qe=[],Ge=[],Xe="undefined"!=typeof Uint8Array?Uint8Array:Array,We="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ve=0,Qe=We.length;Ve<Qe;++Ve)qe[Ve]=We[Ve],Ge[We.charCodeAt(Ve)]=Ve;function $e(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var a=e.indexOf("=");return -1===a&&(a=t),[a,a===t?0:4-a%4]}function et(e,t,a){for(var n,i,r=[],o=t;o<a;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),r.push(qe[(i=n)>>18&63]+qe[i>>12&63]+qe[i>>6&63]+qe[63&i]);return r.join("")}Ge["-".charCodeAt(0)]=62,Ge["_".charCodeAt(0)]=63;var tt={byteLength:Ke,toByteArray:Ye,fromByteArray:Je},at=function(e){function a(t,a,n,i){e.call(this,t,a,n,i),this.type="mbtiles",this.db=this.openDatabase(a.path);}return e&&(a.__proto__=e),a.prototype=Object.create(e&&e.prototype),a.prototype.constructor=a,a.prototype.openDatabase=function(e){return t.Database.openDatabase(e)},a.prototype.copyDatabaseFile=function(e,a,n){return t.Database.copyDatabaseFile(e,a,n)},a.prototype.readTile=function(e,t,a,n){var i=[e,t,a];this.db.then(function(e){e.transaction(function(e){e.executeSql("SELECT BASE64(tile_data) AS base64_tile_data FROM tiles WHERE zoom_level=? AND tile_column=? AND tile_row=?",i,function(e,t){if(t.rows.length){var a=t.rows.item(0).base64_tile_data;if(!a)return void n(void 0,"");try{var r=Me.inflate(tt.toByteArray(a));n(void 0,tt.fromByteArray(r));}catch(e){n(void 0,a);}}else n(new Error("tile "+i.join(",")+" not found"));});},function(e){n(e);});}).catch(function(e){n(e);});},a.prototype.loadTile=function(t,a){var n=t.tileID.canonical,i=n.z>this.maxzoom?Math.pow(2,n.z-this.maxzoom):1,r=Math.min(n.z,this.maxzoom||n.z),o=n.x,s=Math.pow(2,r)-n.y-1;this.readTile(r,o,s,function(r,o){if(r)return this.url&&window.allowMapboxOfflineMapOnlineTile?e.prototype.loadTile.call(this,t,a):a(r);if(void 0===o)return a(new Error("empty data"));var s={request:{url:"data:application/x-protobuf;base64,"+o},uid:t.uid,tileID:t.tileID,zoom:n.z,tileSize:this.tileSize*i,type:this.type,source:this.id,pixelRatio:window.devicePixelRatio||1,overscaling:i,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=a:this.dispatcher.send("reloadTile",s,l.bind(this),t.workerID):t.workerID=this.dispatcher.send("loadTile",s,l.bind(this));function l(e,n){if(!t.aborted){if(e)return a(e);this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),a(null),t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null);}}}.bind(this));},a}(e),nt=function(e){return new Promise(function(t,a){var n=new window.XMLHttpRequest;return n.open("GET",e,!0),n.setRequestHeader("Accept","application/json"),n.onerror=function(e){return a(e)},n.onload=function(){var e=0===n.responseURL.indexOf("file://");if((n.status>=200&&n.status<300||e)&&n.response)try{t(JSON.parse(n.response));}catch(e){a(e);}else a(new Error(n.statusText,n.status));},n.send(),n})},it=window.fetch;window.fetch=function(e,t){return "string"==typeof e.url&&e.url.match(/^file:/)?nt(e.url).then(function(e){return {ok:!0,json:function(){return Promise.resolve(e)},headers:{get:function(){return ""}}}}):it(e,t)};var rt,ot,st=function(e){var t=e.style,a=/^.+:\/\//,n=window.location.origin+window.location.pathname.split("/").slice(0,-1).join("/");return "sprite"in t&&!t.sprite.match(a)&&"glyphs"in t&&!t.glyphs.match(a)&&(t.sprite=n+"/"+t.sprite,t.glyphs=n+"/"+t.glyphs),e};return i.Database=t.Database,i.OfflineMap=function(e){return function(e){return "string"==typeof e.style||e.style instanceof String?nt(e.style).then(function(t){return n.extend({},e,{style:t})}):Promise.resolve(e)}(e).then(st).then(function(e){return (r=e,new Promise(function(e){var i=n.extend({},r.style,{sources:{},layers:[]}),o=n.extend({},r,{style:i}),s=new a(o);s.once("load",function(){var a=new Promise(function(e){s.addSourceType("mbtiles",at,function(){return e()});}),n=new Promise(function(e){s.addSourceType("rasteroffline",t.RasterTileSourceOffline,function(){return e()});}),i=new Promise(function(e){s.addSourceType("raster-dem-offline",t.RasterDEMTileSourceOffline,function(){return e()});});Promise.all([a,n,i]).then(function(){return e(s)});});})).then((i=e.style,function(e){return Object.keys(i.sources).map(function(t){return e.addSource(t,i.sources[t])}),e})).then(function(e){return function(t){return e.layers.map(function(e){return t.addLayer(e)}),t}}(e.style));var i,r;})},rt=!1,ot=a.prototype.setStyle,a.prototype.setStyle=function(){ot.apply(this,arguments),rt||(this.styleUndecorated&&(this.styleUndecorated=void 0),this.once("styledata",function(){this.languageOptions&&this.setLanguage(this.languageOptions.language,this.languageOptions.noAlt);}.bind(this)));},a.prototype.setLanguage=function(e,t){if(this.languageOptions={language:e,noAlt:t},!this.styleUndecorated)try{this.styleUndecorated=this.getStyle();}catch(e){}if(this.styleUndecorated){var a=["ar","hy","be","bg","zh","ka","el","he","ja","ja_kana","kn","kk","ko","mk","ru","sr","th","uk"].indexOf(e)>=0,n=JSON.parse(JSON.stringify(this.styleUndecorated)),i={"layer-filter":["in","layout.text-field","{name}","{name_de}","{name_en}","{name:latin}","{name:latin} {name:nonlatin}","{name:latin}\n{name:nonlatin}"],decorators:[{"layout.text-field":"{name:latin}"+(t?"":"\n{name:nonlatin}"),"filter-all-part":["!has","name:"+e]},{"layer-name-postfix":e,"layout.text-field":"{name:"+e+"}"+(t?"":"\n{name:"+(a?"latin":"nonlatin")+"}"),"filter-all-part":["has","name:"+e]}]};"native"==e&&(i.decorators=[{"layout.text-field":"{name}","filter-all-part":["all"]}]),function(e,t){for(var a=e.layers,n=t["layer-filter"],i=t.decorators,r=n[1],o=n.slice(2),s=a.length-1;s>=0;s--){var l=a[s];if("in"===n[0]&&"layout.text-field"===r&&l.layout&&l.layout["text-field"]&&o.indexOf(l.layout["text-field"])>=0)for(var f=i.length-1;f>=0;f--){var d=i[f],u=d["layer-name-postfix"]||"";if(u=u.replace(/(^-+|-+$)/g,""),f>0){var c=JSON.parse(JSON.stringify(l));a.splice(s+1,0,c);}else c=l;c.id+=u?"-"+u:"",c.layout["text-field"]=d["layout.text-field"],"line"===c.layout["symbol-placement"]&&(c.layout["text-field"]=c.layout["text-field"].replace("\n"," "));var h=d["filter-all-part"].concat();c.filter?"all"==c.filter[0]?c.filter.push(h):c.filter=["all",c.filter,h]:c.filter=h;}}}(n,i),rt=!0,this.setStyle(n),rt=!1;}},a.prototype.autodetectLanguage=function(e){this.setLanguage(navigator.language.split("-")[0]||e||"native");},i});

//

return mapboxgl;

})));
//# sourceMappingURL=mapbox-gl-cordova-offline.js.map
